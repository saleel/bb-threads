(function(){"use strict";/**
 * @license
 * Copyright 2019 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */const U=Symbol("Comlink.proxy"),ae=Symbol("Comlink.endpoint"),le=Symbol("Comlink.releaseProxy"),F=Symbol("Comlink.finalizer"),_=Symbol("Comlink.thrown"),$=e=>typeof e=="object"&&e!==null||typeof e=="function",ce={canHandle:e=>$(e)&&e[U],serialize(e){const{port1:t,port2:r}=new MessageChannel;return R(e,t),[r,[r]]},deserialize(e){return e.start(),he(e)}},ue={canHandle:e=>$(e)&&_ in e,serialize({value:e}){let t;return e instanceof Error?t={isError:!0,value:{message:e.message,name:e.name,stack:e.stack}}:t={isError:!1,value:e},[t,[]]},deserialize(e){throw e.isError?Object.assign(new Error(e.value.message),e.value):e.value}},q=new Map([["proxy",ce],["throw",ue]]);function fe(e,t){for(const r of e)if(t===r||r==="*"||r instanceof RegExp&&r.test(t))return!0;return!1}function R(e,t=globalThis,r=["*"]){t.addEventListener("message",function i(s){if(!s||!s.data)return;if(!fe(r,s.origin)){console.warn(`Invalid origin '${s.origin}' for comlink proxy`);return}const{id:o,type:f,path:c}=Object.assign({path:[]},s.data),m=(s.data.argumentList||[]).map(w);let n;try{const a=c.slice(0,-1).reduce((h,u)=>h[u],e),l=c.reduce((h,u)=>h[u],e);switch(f){case"GET":n=l;break;case"SET":a[c.slice(-1)[0]]=w(s.data.value),n=!0;break;case"APPLY":n=l.apply(a,m);break;case"CONSTRUCT":{const h=new l(...m);n=we(h)}break;case"ENDPOINT":{const{port1:h,port2:u}=new MessageChannel;R(e,u),n=ye(h,[h])}break;case"RELEASE":n=void 0;break;default:return}}catch(a){n={value:a,[_]:0}}Promise.resolve(n).catch(a=>({value:a,[_]:0})).then(a=>{const[l,h]=T(a);t.postMessage(Object.assign(Object.assign({},l),{id:o}),h),f==="RELEASE"&&(t.removeEventListener("message",i),G(t),F in e&&typeof e[F]=="function"&&e[F]())}).catch(a=>{const[l,h]=T({value:new TypeError("Unserializable return value"),[_]:0});t.postMessage(Object.assign(Object.assign({},l),{id:o}),h)})}),t.start&&t.start()}function me(e){return e.constructor.name==="MessagePort"}function G(e){me(e)&&e.close()}function he(e,t){const r=new Map;return e.addEventListener("message",function(s){const{data:o}=s;if(!o||!o.id)return;const f=r.get(o.id);if(f)try{f(o)}finally{r.delete(o.id)}}),V(e,r,[],t)}function z(e){if(e)throw new Error("Proxy has been released and is not useable")}function K(e){return p(e,new Map,{type:"RELEASE"}).then(()=>{G(e)})}const L=new WeakMap,M="FinalizationRegistry"in globalThis&&new FinalizationRegistry(e=>{const t=(L.get(e)||0)-1;L.set(e,t),t===0&&K(e)});function ge(e,t){const r=(L.get(t)||0)+1;L.set(t,r),M&&M.register(e,t,e)}function be(e){M&&M.unregister(e)}function V(e,t,r=[],i=function(){}){let s=!1;const o=new Proxy(i,{get(f,c){if(z(s),c===le)return()=>{be(o),K(e),t.clear(),s=!0};if(c==="then"){if(r.length===0)return{then:()=>o};const m=p(e,t,{type:"GET",path:r.map(n=>n.toString())}).then(w);return m.then.bind(m)}return V(e,t,[...r,c])},set(f,c,m){z(s);const[n,a]=T(m);return p(e,t,{type:"SET",path:[...r,c].map(l=>l.toString()),value:n},a).then(w)},apply(f,c,m){z(s);const n=r[r.length-1];if(n===ae)return p(e,t,{type:"ENDPOINT"}).then(w);if(n==="bind")return V(e,t,r.slice(0,-1));const[a,l]=Y(m);return p(e,t,{type:"APPLY",path:r.map(h=>h.toString()),argumentList:a},l).then(w)},construct(f,c){z(s);const[m,n]=Y(c);return p(e,t,{type:"CONSTRUCT",path:r.map(a=>a.toString()),argumentList:m},n).then(w)}});return ge(o,e),o}function de(e){return Array.prototype.concat.apply([],e)}function Y(e){const t=e.map(T);return[t.map(r=>r[0]),de(t.map(r=>r[1]))]}const X=new WeakMap;function ye(e,t){return X.set(e,t),e}function we(e){return Object.assign(e,{[U]:!0})}function T(e){for(const[t,r]of q)if(r.canHandle(e)){const[i,s]=r.serialize(e);return[{type:"HANDLER",name:t,value:i},s]}return[{type:"RAW",value:e},X.get(e)||[]]}function w(e){switch(e.type){case"HANDLER":return q.get(e.name).deserialize(e.value);case"RAW":return e.value}}function p(e,t,r,i){return new Promise(s=>{const o=ve();t.set(o,s),e.start&&e.start(),e.postMessage(Object.assign({id:o},r),i)})}function ve(){return new Array(4).fill(0).map(()=>Math.floor(Math.random()*Number.MAX_SAFE_INTEGER).toString(16)).join("-")}function pe(){return console.log}function J(){self.close()}const Ee={ready:!0};var I={exports:{}};function Oe(e){try{return JSON.stringify(e)}catch{return'"[Circular]"'}}var je=Se;function Se(e,t,r){var i=r&&r.stringify||Oe,s=1;if(typeof e=="object"&&e!==null){var o=t.length+s;if(o===1)return e;var f=new Array(o);f[0]=i(e);for(var c=1;c<o;c++)f[c]=i(t[c]);return f.join(" ")}if(typeof e!="string")return e;var m=t.length;if(m===0)return e;for(var n="",a=1-s,l=-1,h=e&&e.length||0,u=0;u<h;){if(e.charCodeAt(u)===37&&u+1<h){switch(l=l>-1?l:0,e.charCodeAt(u+1)){case 100:case 102:if(a>=m||t[a]==null)break;l<u&&(n+=e.slice(l,u)),n+=Number(t[a]),l=u+2,u++;break;case 105:if(a>=m||t[a]==null)break;l<u&&(n+=e.slice(l,u)),n+=Math.floor(Number(t[a])),l=u+2,u++;break;case 79:case 111:case 106:if(a>=m||t[a]===void 0)break;l<u&&(n+=e.slice(l,u));var j=typeof t[a];if(j==="string"){n+="'"+t[a]+"'",l=u+2,u++;break}if(j==="function"){n+=t[a].name||"<anonymous>",l=u+2,u++;break}n+=i(t[a]),l=u+2,u++;break;case 115:if(a>=m)break;l<u&&(n+=e.slice(l,u)),n+=String(t[a]),l=u+2,u++;break;case 37:l<u&&(n+=e.slice(l,u)),n+="%",l=u+2,u++,a--;break}++a}++u}return l===-1?e:(l<h&&(n+=e.slice(l)),n)}const Q=je;I.exports=b;const O=De().console||{},ke={mapHttpRequest:x,mapHttpResponse:x,wrapRequestSerializer:H,wrapResponseSerializer:H,wrapErrorSerializer:H,req:x,res:x,err:ee,errWithCause:ee};function y(e,t){return e==="silent"?1/0:t.levels.values[e]}const D=Symbol("pino.logFuncs"),N=Symbol("pino.hierarchy"),_e={error:"log",fatal:"error",warn:"error",info:"log",debug:"log",trace:"log"};function Z(e,t){const r={logger:t,parent:e[N]};t[N]=r}function ze(e,t,r){const i={};t.forEach(s=>{i[s]=r[s]?r[s]:O[s]||O[_e[s]||"log"]||E}),e[D]=i}function Le(e,t){return Array.isArray(e)?e.filter(function(i){return i!=="!stdSerializers.err"}):e===!0?Object.keys(t):!1}function b(e){e=e||{},e.browser=e.browser||{};const t=e.browser.transmit;if(t&&typeof t.send!="function")throw Error("pino: transmit option must have a send function");const r=e.browser.write||O;e.browser.write&&(e.browser.asObject=!0);const i=e.serializers||{},s=Le(e.browser.serialize,i);let o=e.browser.serialize;Array.isArray(e.browser.serialize)&&e.browser.serialize.indexOf("!stdSerializers.err")>-1&&(o=!1);const f=Object.keys(e.customLevels||{}),c=["error","fatal","warn","info","debug","trace"].concat(f);typeof r=="function"&&c.forEach(function(g){r[g]=r}),(e.enabled===!1||e.browser.disabled)&&(e.level="silent");const m=e.level||"info",n=Object.create(r);n.log||(n.log=E),ze(n,c,r),Z({},n),Object.defineProperty(n,"levelVal",{get:l}),Object.defineProperty(n,"level",{get:h,set:u});const a={transmit:t,serialize:s,asObject:e.browser.asObject,asObjectBindingsOnly:e.browser.asObjectBindingsOnly,formatters:e.browser.formatters,levels:c,timestamp:Re(e),messageKey:e.messageKey||"msg",onChild:e.onChild||E};n.levels=Me(e),n.level=m,n.isLevelEnabled=function(g){return this.levels.values[g]?this.levels.values[g]>=this.levels.values[this.level]:!1},n.setMaxListeners=n.getMaxListeners=n.emit=n.addListener=n.on=n.prependListener=n.once=n.prependOnceListener=n.removeListener=n.removeAllListeners=n.listeners=n.listenerCount=n.eventNames=n.write=n.flush=E,n.serializers=i,n._serialize=s,n._stdErrSerialize=o,n.child=function(...g){return j.call(this,a,...g)},t&&(n._logEvent=B());function l(){return y(this.level,this)}function h(){return this._level}function u(g){if(g!=="silent"&&!this.levels.values[g])throw Error("unknown level "+g);this._level=g,v(this,a,n,"error"),v(this,a,n,"fatal"),v(this,a,n,"warn"),v(this,a,n,"info"),v(this,a,n,"debug"),v(this,a,n,"trace"),f.forEach(d=>{v(this,a,n,d)})}function j(g,d,S){if(!d)throw new Error("missing bindings for child Pino");S=S||{},s&&d.serializers&&(S.serializers=d.serializers);const se=S.serializers;if(s&&se){var C=Object.assign({},i,se),ie=e.browser.serialize===!0?Object.keys(C):s;delete d.serializers,W([d],ie,C,this._stdErrSerialize)}function oe(P){this._childLevel=(P._childLevel|0)+1,this.bindings=d,C&&(this.serializers=C,this._serialize=ie),t&&(this._logEvent=B([].concat(P._logEvent.bindings,d)))}oe.prototype=this;const k=new oe(this);return Z(this,k),k.child=function(...P){return j.call(this,g,...P)},k.level=S.level||this.level,g.onChild(k),k}return n}function Me(e){const t=e.customLevels||{},r=Object.assign({},b.levels.values,t),i=Object.assign({},b.levels.labels,Te(t));return{values:r,labels:i}}function Te(e){const t={};return Object.keys(e).forEach(function(r){t[e[r]]=r}),t}b.levels={values:{fatal:60,error:50,warn:40,info:30,debug:20,trace:10},labels:{10:"trace",20:"debug",30:"info",40:"warn",50:"error",60:"fatal"}},b.stdSerializers=ke,b.stdTimeFunctions=Object.assign({},{nullTime:te,epochTime:re,unixTime:Ve,isoTime:Ie});function xe(e){const t=[];e.bindings&&t.push(e.bindings);let r=e[N];for(;r.parent;)r=r.parent,r.logger.bindings&&t.push(r.logger.bindings);return t.reverse()}function v(e,t,r,i){if(Object.defineProperty(e,i,{value:y(e.level,r)>y(i,r)?E:r[D][i],writable:!0,enumerable:!0,configurable:!0}),e[i]===E){if(!t.transmit)return;const o=t.transmit.level||e.level,f=y(o,r);if(y(i,r)<f)return}e[i]=Ce(e,t,r,i);const s=xe(e);s.length!==0&&(e[i]=Ae(s,e[i]))}function Ae(e,t){return function(){return t.apply(this,[...e,...arguments])}}function Ce(e,t,r,i){return function(s){return function(){const f=t.timestamp(),c=new Array(arguments.length),m=Object.getPrototypeOf&&Object.getPrototypeOf(this)===O?O:this;for(var n=0;n<c.length;n++)c[n]=arguments[n];var a=!1;if(t.serialize&&(W(c,this._serialize,this.serializers,this._stdErrSerialize),a=!0),t.asObject||t.formatters?s.call(m,...Pe(this,i,c,f,t)):s.apply(m,c),t.transmit){const l=t.transmit.level||e._level,h=y(l,r),u=y(i,r);if(u<h)return;Fe(this,{ts:f,methodLevel:i,methodValue:u,transmitLevel:l,transmitValue:r.levels.values[t.transmit.level||e._level],send:t.transmit.send,val:y(e._level,r)},c,a)}}}(e[D][i])}function Pe(e,t,r,i,s){const{level:o,log:f=l=>l}=s.formatters||{},c=r.slice();let m=c[0];const n={};let a=(e._childLevel|0)+1;if(a<1&&(a=1),i&&(n.time=i),o){const l=o(t,e.levels.values[t]);Object.assign(n,l)}else n.level=e.levels.values[t];if(s.asObjectBindingsOnly){if(m!==null&&typeof m=="object")for(;a--&&typeof c[0]=="object";)Object.assign(n,c.shift());return[f(n),...c]}else{if(m!==null&&typeof m=="object"){for(;a--&&typeof c[0]=="object";)Object.assign(n,c.shift());m=c.length?Q(c.shift(),c):void 0}else typeof m=="string"&&(m=Q(c.shift(),c));return m!==void 0&&(n[s.messageKey]=m),[f(n)]}}function W(e,t,r,i){for(const s in e)if(i&&e[s]instanceof Error)e[s]=b.stdSerializers.err(e[s]);else if(typeof e[s]=="object"&&!Array.isArray(e[s])&&t)for(const o in e[s])t.indexOf(o)>-1&&o in r&&(e[s][o]=r[o](e[s][o]))}function Fe(e,t,r,i=!1){const s=t.send,o=t.ts,f=t.methodLevel,c=t.methodValue,m=t.val,n=e._logEvent.bindings;i||W(r,e._serialize||Object.keys(e.serializers),e.serializers,e._stdErrSerialize===void 0?!0:e._stdErrSerialize),e._logEvent.ts=o,e._logEvent.messages=r.filter(function(a){return n.indexOf(a)===-1}),e._logEvent.level.label=f,e._logEvent.level.value=c,s(f,e._logEvent,m),e._logEvent=B(n)}function B(e){return{ts:0,messages:[],bindings:e||[],level:{label:"",value:0}}}function ee(e){const t={type:e.constructor.name,msg:e.message,stack:e.stack};for(const r in e)t[r]===void 0&&(t[r]=e[r]);return t}function Re(e){return typeof e.timestamp=="function"?e.timestamp:e.timestamp===!1?te:re}function x(){return{}}function H(e){return e}function E(){}function te(){return!1}function re(){return Date.now()}function Ve(){return Math.round(Date.now()/1e3)}function Ie(){return new Date(Date.now()).toISOString()}function De(){function e(t){return typeof t<"u"&&t}try{return typeof globalThis<"u"||Object.defineProperty(Object.prototype,"globalThis",{get:function(){return delete Object.prototype.globalThis,this.globalThis=this},configurable:!0}),globalThis}catch{return e(self)||e(window)||e(this)||{}}}I.exports.default=b;var Ne=I.exports.pino=b;const We={name:"bb.js",useOnlyCustomLevels:!1,customLevels:{verbose:25},browser:{asObject:!1}};let A;function ne({level:e="info"}={level:"info",useStdErr:!1}){if(A)return A;A=Ne({...We,level:e})}function Be(e){ne();const t=A.child({name:e});return r=>{t.debug(r)}}const He=e=>{const r=(()=>{if(typeof window<"u"&&window.crypto)return window.crypto;if(typeof globalThis<"u"&&globalThis.crypto)return globalThis.crypto})();if(!r)throw new Error("randomBytes UnsupportedEnvironment");const i=new Uint8Array(e),s=65536;if(e>s)for(let o=0;o<e;o+=s)r.getRandomValues(i.subarray(o,o+s));else r.getRandomValues(i);return i};class Ue{constructor(){this.memStore={},this.logger=Be("bb_wasm_base")}getImportObj(t){return{wasi_snapshot_preview1:{random_get:(i,s)=>{i=i>>>0;const o=He(s);this.getMemory().set(o,i)},clock_time_get:(i,s,o)=>{o=o>>>0;const f=BigInt(new Date().getTime())*1000000n;new DataView(this.getMemory().buffer).setBigUint64(o,f,!0)},proc_exit:()=>{throw this.logger("PANIC: proc_exit was called."),new Error}},env:{logstr:i=>{const s=this.stringFromAddress(i),o=this.getMemory(),f=`${s} (mem: ${(o.length/(1024*1024)).toFixed(2)}MiB)`;this.logger(f)},get_data:(i,s)=>{const o=this.stringFromAddress(i);s=s>>>0;const f=this.memStore[o];if(!f){this.logger(`get_data miss ${o}`);return}this.writeMemory(s,f)},set_data:(i,s,o)=>{const f=this.stringFromAddress(i);s=s>>>0,this.memStore[f]=this.getMemorySlice(s,s+o)},memory:t}}}exports(){return this.instance.exports}call(t,...r){if(!this.exports()[t])throw new Error(`WASM function ${t} not found.`);try{return this.exports()[t](...r)>>>0}catch(i){const s=`WASM function ${t} aborted, error: ${i}`;throw this.logger(s),this.logger(i.stack),i}}memSize(){return this.getMemory().length}getMemorySlice(t,r){return this.getMemory().subarray(t,r).slice()}writeMemory(t,r){this.getMemory().set(r,t)}getMemory(){return new Uint8Array(this.memory.buffer)}stringFromAddress(t){t=t>>>0;const r=this.getMemory();let i=t;for(;r[i]!==0;++i);return new TextDecoder("ascii").decode(r.slice(t,i))}}class $e extends Ue{async initThread(t,r){this.logger=pe()||this.logger,this.memory=r,this.instance=await WebAssembly.instantiate(t,this.getImportObj(this.memory))}destroy(){J()}getImportObj(t){const r=super.getImportObj(t);return{...r,wasi:{"thread-spawn":()=>{this.logger("PANIC: threads cannot spawn threads!"),this.logger(new Error().stack),J()}},env:{...r.env,env_hardware_concurrency:()=>1}}}}addEventListener("message",e=>{e.data.log&&ne(e.data.log)}),R(new $e),postMessage(Ee)})();
