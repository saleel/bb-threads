(function(){"use strict";/**
 * @license
 * Copyright 2019 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */const N=Symbol("Comlink.proxy"),ue=Symbol("Comlink.endpoint"),fe=Symbol("Comlink.releaseProxy"),W=Symbol("Comlink.finalizer"),_=Symbol("Comlink.thrown"),q=e=>typeof e=="object"&&e!==null||typeof e=="function",he={canHandle:e=>q(e)&&e[N],serialize(e){const{port1:t,port2:r}=new MessageChannel;return V(e,t),[r,[r]]},deserialize(e){return e.start(),K(e)}},me={canHandle:e=>q(e)&&_ in e,serialize({value:e}){let t;return e instanceof Error?t={isError:!0,value:{message:e.message,name:e.name,stack:e.stack}}:t={isError:!1,value:e},[t,[]]},deserialize(e){throw e.isError?Object.assign(new Error(e.value.message),e.value):e.value}},G=new Map([["proxy",he],["throw",me]]);function ge(e,t){for(const r of e)if(t===r||r==="*"||r instanceof RegExp&&r.test(t))return!0;return!1}function V(e,t=globalThis,r=["*"]){t.addEventListener("message",function n(s){if(!s||!s.data)return;if(!ge(r,s.origin)){console.warn(`Invalid origin '${s.origin}' for comlink proxy`);return}const{id:a,type:c,path:o}=Object.assign({path:[]},s.data),f=(s.data.argumentList||[]).map(w);let i;try{const l=o.slice(0,-1).reduce((m,h)=>m[h],e),u=o.reduce((m,h)=>m[h],e);switch(c){case"GET":i=u;break;case"SET":l[o.slice(-1)[0]]=w(s.data.value),i=!0;break;case"APPLY":i=u.apply(l,f);break;case"CONSTRUCT":{const m=new u(...f);i=ve(m)}break;case"ENDPOINT":{const{port1:m,port2:h}=new MessageChannel;V(e,h),i=pe(m,[m])}break;case"RELEASE":i=void 0;break;default:return}}catch(l){i={value:l,[_]:0}}Promise.resolve(i).catch(l=>({value:l,[_]:0})).then(l=>{const[u,m]=T(l);t.postMessage(Object.assign(Object.assign({},u),{id:a}),m),c==="RELEASE"&&(t.removeEventListener("message",n),X(t),W in e&&typeof e[W]=="function"&&e[W]())}).catch(l=>{const[u,m]=T({value:new TypeError("Unserializable return value"),[_]:0});t.postMessage(Object.assign(Object.assign({},u),{id:a}),m)})}),t.start&&t.start()}function de(e){return e.constructor.name==="MessagePort"}function X(e){de(e)&&e.close()}function K(e,t){const r=new Map;return e.addEventListener("message",function(s){const{data:a}=s;if(!a||!a.id)return;const c=r.get(a.id);if(c)try{c(a)}finally{r.delete(a.id)}}),F(e,r,[],t)}function j(e){if(e)throw new Error("Proxy has been released and is not useable")}function Y(e){return v(e,new Map,{type:"RELEASE"}).then(()=>{X(e)})}const A=new WeakMap,z="FinalizationRegistry"in globalThis&&new FinalizationRegistry(e=>{const t=(A.get(e)||0)-1;A.set(e,t),t===0&&Y(e)});function be(e,t){const r=(A.get(t)||0)+1;A.set(t,r),z&&z.register(e,t,e)}function ye(e){z&&z.unregister(e)}function F(e,t,r=[],n=function(){}){let s=!1;const a=new Proxy(n,{get(c,o){if(j(s),o===fe)return()=>{ye(a),Y(e),t.clear(),s=!0};if(o==="then"){if(r.length===0)return{then:()=>a};const f=v(e,t,{type:"GET",path:r.map(i=>i.toString())}).then(w);return f.then.bind(f)}return F(e,t,[...r,o])},set(c,o,f){j(s);const[i,l]=T(f);return v(e,t,{type:"SET",path:[...r,o].map(u=>u.toString()),value:i},l).then(w)},apply(c,o,f){j(s);const i=r[r.length-1];if(i===ue)return v(e,t,{type:"ENDPOINT"}).then(w);if(i==="bind")return F(e,t,r.slice(0,-1));const[l,u]=J(f);return v(e,t,{type:"APPLY",path:r.map(m=>m.toString()),argumentList:l},u).then(w)},construct(c,o){j(s);const[f,i]=J(o);return v(e,t,{type:"CONSTRUCT",path:r.map(l=>l.toString()),argumentList:f},i).then(w)}});return be(a,e),a}function we(e){return Array.prototype.concat.apply([],e)}function J(e){const t=e.map(T);return[t.map(r=>r[0]),we(t.map(r=>r[1]))]}const Q=new WeakMap;function pe(e,t){return Q.set(e,t),e}function ve(e){return Object.assign(e,{[N]:!0})}function T(e){for(const[t,r]of G)if(r.canHandle(e)){const[n,s]=r.serialize(e);return[{type:"HANDLER",name:t,value:n},s]}return[{type:"RAW",value:e},Q.get(e)||[]]}function w(e){switch(e.type){case"HANDLER":return G.get(e.name).deserialize(e.value);case"RAW":return e.value}}function v(e,t,r,n){return new Promise(s=>{const a=Ee();t.set(a,s),e.start&&e.start(),e.postMessage(Object.assign({id:a},r),n)})}function Ee(){return new Array(4).fill(0).map(()=>Math.floor(Math.random()*Number.MAX_SAFE_INTEGER).toString(16)).join("-")}function Oe(){const e=typeof window<"u"?window:globalThis;return typeof SharedArrayBuffer<"u"&&e.crossOriginIsolated}function Se(e){return K(e)}function ke(){return navigator.hardwareConcurrency}const Me={ready:!0};function _e(e,t){e.addEventListener("message",function r(n){n.data&&n.data.ready===!0&&(e.removeEventListener("message",r),t())})}var I={exports:{}};function je(e){try{return JSON.stringify(e)}catch{return'"[Circular]"'}}var Ae=ze;function ze(e,t,r){var n=r&&r.stringify||je,s=1;if(typeof e=="object"&&e!==null){var a=t.length+s;if(a===1)return e;var c=new Array(a);c[0]=n(e);for(var o=1;o<a;o++)c[o]=n(t[o]);return c.join(" ")}if(typeof e!="string")return e;var f=t.length;if(f===0)return e;for(var i="",l=1-s,u=-1,m=e&&e.length||0,h=0;h<m;){if(e.charCodeAt(h)===37&&h+1<m){switch(u=u>-1?u:0,e.charCodeAt(h+1)){case 100:case 102:if(l>=f||t[l]==null)break;u<h&&(i+=e.slice(u,h)),i+=Number(t[l]),u=h+2,h++;break;case 105:if(l>=f||t[l]==null)break;u<h&&(i+=e.slice(u,h)),i+=Math.floor(Number(t[l])),u=h+2,h++;break;case 79:case 111:case 106:if(l>=f||t[l]===void 0)break;u<h&&(i+=e.slice(u,h));var S=typeof t[l];if(S==="string"){i+="'"+t[l]+"'",u=h+2,h++;break}if(S==="function"){i+=t[l].name||"<anonymous>",u=h+2,h++;break}i+=n(t[l]),u=h+2,h++;break;case 115:if(l>=f)break;u<h&&(i+=e.slice(u,h)),i+=String(t[l]),u=h+2,h++;break;case 37:u<h&&(i+=e.slice(u,h)),i+="%",u=h+2,h++,l--;break}++l}++h}return u===-1?e:(u<m&&(i+=e.slice(u)),i)}const Z=Ae;I.exports=d;const O=Ue().console||{},Te={mapHttpRequest:L,mapHttpResponse:L,wrapRequestSerializer:U,wrapResponseSerializer:U,wrapErrorSerializer:U,req:L,res:L,err:te,errWithCause:te};function y(e,t){return e==="silent"?1/0:t.levels.values[e]}const D=Symbol("pino.logFuncs"),B=Symbol("pino.hierarchy"),Le={error:"log",fatal:"error",warn:"error",info:"log",debug:"log",trace:"log"};function ee(e,t){const r={logger:t,parent:e[B]};t[B]=r}function xe(e,t,r){const n={};t.forEach(s=>{n[s]=r[s]?r[s]:O[s]||O[Le[s]||"log"]||E}),e[D]=n}function Pe(e,t){return Array.isArray(e)?e.filter(function(n){return n!=="!stdSerializers.err"}):e===!0?Object.keys(t):!1}function d(e){e=e||{},e.browser=e.browser||{};const t=e.browser.transmit;if(t&&typeof t.send!="function")throw Error("pino: transmit option must have a send function");const r=e.browser.write||O;e.browser.write&&(e.browser.asObject=!0);const n=e.serializers||{},s=Pe(e.browser.serialize,n);let a=e.browser.serialize;Array.isArray(e.browser.serialize)&&e.browser.serialize.indexOf("!stdSerializers.err")>-1&&(a=!1);const c=Object.keys(e.customLevels||{}),o=["error","fatal","warn","info","debug","trace"].concat(c);typeof r=="function"&&o.forEach(function(g){r[g]=r}),(e.enabled===!1||e.browser.disabled)&&(e.level="silent");const f=e.level||"info",i=Object.create(r);i.log||(i.log=E),xe(i,o,r),ee({},i),Object.defineProperty(i,"levelVal",{get:u}),Object.defineProperty(i,"level",{get:m,set:h});const l={transmit:t,serialize:s,asObject:e.browser.asObject,asObjectBindingsOnly:e.browser.asObjectBindingsOnly,formatters:e.browser.formatters,levels:o,timestamp:Be(e),messageKey:e.messageKey||"msg",onChild:e.onChild||E};i.levels=Ce(e),i.level=f,i.isLevelEnabled=function(g){return this.levels.values[g]?this.levels.values[g]>=this.levels.values[this.level]:!1},i.setMaxListeners=i.getMaxListeners=i.emit=i.addListener=i.on=i.prependListener=i.once=i.prependOnceListener=i.removeListener=i.removeAllListeners=i.listeners=i.listenerCount=i.eventNames=i.write=i.flush=E,i.serializers=n,i._serialize=s,i._stdErrSerialize=a,i.child=function(...g){return S.call(this,l,...g)},t&&(i._logEvent=H());function u(){return y(this.level,this)}function m(){return this._level}function h(g){if(g!=="silent"&&!this.levels.values[g])throw Error("unknown level "+g);this._level=g,p(this,l,i,"error"),p(this,l,i,"fatal"),p(this,l,i,"warn"),p(this,l,i,"info"),p(this,l,i,"debug"),p(this,l,i,"trace"),c.forEach(b=>{p(this,l,i,b)})}function S(g,b,k){if(!b)throw new Error("missing bindings for child Pino");k=k||{},s&&b.serializers&&(k.serializers=b.serializers);const oe=k.serializers;if(s&&oe){var C=Object.assign({},n,oe),le=e.browser.serialize===!0?Object.keys(C):s;delete b.serializers,$([b],le,C,this._stdErrSerialize)}function ce(R){this._childLevel=(R._childLevel|0)+1,this.bindings=b,C&&(this.serializers=C,this._serialize=le),t&&(this._logEvent=H([].concat(R._logEvent.bindings,b)))}ce.prototype=this;const M=new ce(this);return ee(this,M),M.child=function(...R){return S.call(this,g,...R)},M.level=k.level||this.level,g.onChild(M),M}return i}function Ce(e){const t=e.customLevels||{},r=Object.assign({},d.levels.values,t),n=Object.assign({},d.levels.labels,Re(t));return{values:r,labels:n}}function Re(e){const t={};return Object.keys(e).forEach(function(r){t[e[r]]=r}),t}d.levels={values:{fatal:60,error:50,warn:40,info:30,debug:20,trace:10},labels:{10:"trace",20:"debug",30:"info",40:"warn",50:"error",60:"fatal"}},d.stdSerializers=Te,d.stdTimeFunctions=Object.assign({},{nullTime:re,epochTime:ne,unixTime:$e,isoTime:He});function We(e){const t=[];e.bindings&&t.push(e.bindings);let r=e[B];for(;r.parent;)r=r.parent,r.logger.bindings&&t.push(r.logger.bindings);return t.reverse()}function p(e,t,r,n){if(Object.defineProperty(e,n,{value:y(e.level,r)>y(n,r)?E:r[D][n],writable:!0,enumerable:!0,configurable:!0}),e[n]===E){if(!t.transmit)return;const a=t.transmit.level||e.level,c=y(a,r);if(y(n,r)<c)return}e[n]=Fe(e,t,r,n);const s=We(e);s.length!==0&&(e[n]=Ve(s,e[n]))}function Ve(e,t){return function(){return t.apply(this,[...e,...arguments])}}function Fe(e,t,r,n){return function(s){return function(){const c=t.timestamp(),o=new Array(arguments.length),f=Object.getPrototypeOf&&Object.getPrototypeOf(this)===O?O:this;for(var i=0;i<o.length;i++)o[i]=arguments[i];var l=!1;if(t.serialize&&($(o,this._serialize,this.serializers,this._stdErrSerialize),l=!0),t.asObject||t.formatters?s.call(f,...Ie(this,n,o,c,t)):s.apply(f,o),t.transmit){const u=t.transmit.level||e._level,m=y(u,r),h=y(n,r);if(h<m)return;De(this,{ts:c,methodLevel:n,methodValue:h,transmitLevel:u,transmitValue:r.levels.values[t.transmit.level||e._level],send:t.transmit.send,val:y(e._level,r)},o,l)}}}(e[D][n])}function Ie(e,t,r,n,s){const{level:a,log:c=u=>u}=s.formatters||{},o=r.slice();let f=o[0];const i={};let l=(e._childLevel|0)+1;if(l<1&&(l=1),n&&(i.time=n),a){const u=a(t,e.levels.values[t]);Object.assign(i,u)}else i.level=e.levels.values[t];if(s.asObjectBindingsOnly){if(f!==null&&typeof f=="object")for(;l--&&typeof o[0]=="object";)Object.assign(i,o.shift());return[c(i),...o]}else{if(f!==null&&typeof f=="object"){for(;l--&&typeof o[0]=="object";)Object.assign(i,o.shift());f=o.length?Z(o.shift(),o):void 0}else typeof f=="string"&&(f=Z(o.shift(),o));return f!==void 0&&(i[s.messageKey]=f),[c(i)]}}function $(e,t,r,n){for(const s in e)if(n&&e[s]instanceof Error)e[s]=d.stdSerializers.err(e[s]);else if(typeof e[s]=="object"&&!Array.isArray(e[s])&&t)for(const a in e[s])t.indexOf(a)>-1&&a in r&&(e[s][a]=r[a](e[s][a]))}function De(e,t,r,n=!1){const s=t.send,a=t.ts,c=t.methodLevel,o=t.methodValue,f=t.val,i=e._logEvent.bindings;n||$(r,e._serialize||Object.keys(e.serializers),e.serializers,e._stdErrSerialize===void 0?!0:e._stdErrSerialize),e._logEvent.ts=a,e._logEvent.messages=r.filter(function(l){return i.indexOf(l)===-1}),e._logEvent.level.label=c,e._logEvent.level.value=o,s(c,e._logEvent,f),e._logEvent=H(i)}function H(e){return{ts:0,messages:[],bindings:e||[],level:{label:"",value:0}}}function te(e){const t={type:e.constructor.name,msg:e.message,stack:e.stack};for(const r in e)t[r]===void 0&&(t[r]=e[r]);return t}function Be(e){return typeof e.timestamp=="function"?e.timestamp:e.timestamp===!1?re:ne}function L(){return{}}function U(e){return e}function E(){}function re(){return!1}function ne(){return Date.now()}function $e(){return Math.round(Date.now()/1e3)}function He(){return new Date(Date.now()).toISOString()}function Ue(){function e(t){return typeof t<"u"&&t}try{return typeof globalThis<"u"||Object.defineProperty(Object.prototype,"globalThis",{get:function(){return delete Object.prototype.globalThis,this.globalThis=this},configurable:!0}),globalThis}catch{return e(self)||e(window)||e(this)||{}}}I.exports.default=d;var Ne=I.exports.pino=d;const qe={name:"bb.js",useOnlyCustomLevels:!1,customLevels:{verbose:25},browser:{asObject:!1}};let se,x;function ie({level:e="info"}={level:"info",useStdErr:!1}){if(x)return x;se={level:e,useStdErr:!1},x=Ne({...qe,level:e})}function ae(e){ie();const t=x.child({name:e});return r=>{t.debug(r)}}async function Ge(){const e=new Worker(new URL("/assets/thread.worker-DBvk3-cx.js",self.location.href),{type:"module"});return e.postMessage({log:se}),await new Promise(t=>_e(e,t)),e}const Xe=e=>{const r=(()=>{if(typeof window<"u"&&window.crypto)return window.crypto;if(typeof globalThis<"u"&&globalThis.crypto)return globalThis.crypto})();if(!r)throw new Error("randomBytes UnsupportedEnvironment");const n=new Uint8Array(e),s=65536;if(e>s)for(let a=0;a<e;a+=s)r.getRandomValues(n.subarray(a,a+s));else r.getRandomValues(n);return n};class Ke{constructor(){this.memStore={},this.logger=ae("bb_wasm_base")}getImportObj(t){return{wasi_snapshot_preview1:{random_get:(n,s)=>{n=n>>>0;const a=Xe(s);this.getMemory().set(a,n)},clock_time_get:(n,s,a)=>{a=a>>>0;const c=BigInt(new Date().getTime())*1000000n;new DataView(this.getMemory().buffer).setBigUint64(a,c,!0)},proc_exit:()=>{throw this.logger("PANIC: proc_exit was called."),new Error}},env:{logstr:n=>{const s=this.stringFromAddress(n),a=this.getMemory(),c=`${s} (mem: ${(a.length/(1024*1024)).toFixed(2)}MiB)`;this.logger(c)},get_data:(n,s)=>{const a=this.stringFromAddress(n);s=s>>>0;const c=this.memStore[a];if(!c){this.logger(`get_data miss ${a}`);return}this.writeMemory(s,c)},set_data:(n,s,a)=>{const c=this.stringFromAddress(n);s=s>>>0,this.memStore[c]=this.getMemorySlice(s,s+a)},memory:t}}}exports(){return this.instance.exports}call(t,...r){if(!this.exports()[t])throw new Error(`WASM function ${t} not found.`);try{return this.exports()[t](...r)>>>0}catch(n){const s=`WASM function ${t} aborted, error: ${n}`;throw this.logger(s),this.logger(n.stack),n}}memSize(){return this.getMemory().length}getMemorySlice(t,r){return this.getMemory().subarray(t,r).slice()}writeMemory(t,r){this.getMemory().set(r,t)}getMemory(){return new Uint8Array(this.memory.buffer)}stringFromAddress(t){t=t>>>0;const r=this.getMemory();let n=t;for(;r[n]!==0;++n);return new TextDecoder("ascii").decode(r.slice(t,n))}}class Ye{constructor(t){this.wasm=t,this.allocs=[],this.inScratchRemaining=1024,this.outScratchRemaining=1024}getInputs(t){return t.map(r=>{if(typeof r=="object")if(r.length<=this.inScratchRemaining){const n=this.inScratchRemaining-=r.length;return this.wasm.writeMemory(n,r),n}else{const n=this.wasm.call("bbmalloc",r.length);return this.wasm.writeMemory(n,r),this.allocs.push(n),n}else return r})}getOutputPtrs(t){return t.map(r=>{const n=r||4;if(n<=this.outScratchRemaining)return this.outScratchRemaining-=n;{const s=this.wasm.call("bbmalloc",n);return this.allocs.push(s),s}})}addOutputPtr(t){t>=1024&&this.allocs.push(t)}freeAll(){for(const t of this.allocs)this.wasm.call("bbfree",t)}}class P extends Ke{constructor(){super(...arguments),this.workers=[],this.remoteWasms=[],this.nextWorker=0,this.nextThreadId=1}getNumThreads(){return this.workers.length+1}async init(t,r=Math.min(ke(),P.MAX_THREADS),n=ae("bb_wasm"),s=32,a=2**16){this.logger=n;const c=s*2**16/(1024*1024),o=a*2**16/(1024*1024),f=Oe();this.logger(`Initializing bb wasm: initial memory ${s} pages ${c}MiB; max memory: ${a} pages, ${o}MiB; threads: ${r}; shared memory: ${f}`),this.logger("saleel: calling new WebAssembly.Memory"),this.memory=new WebAssembly.Memory({initial:s,maximum:a,shared:f}),this.logger("saleel: calling new WebAssembly.Memory done"),this.logger("saleel: calling WebAssembly.instantiate");const i=await WebAssembly.instantiate(t,this.getImportObj(this.memory));this.logger("saleel: calling WebAssembly.instantiate done"),this.logger("saleel: calling _initialize"),this.instance=i,this.call("_initialize"),r>1&&(this.logger(`Creating ${r} worker threads`),this.workers=await Promise.all(Array.from({length:r-1}).map(Ge)),this.remoteWasms=await Promise.all(this.workers.map(Se)),await Promise.all(this.remoteWasms.map(l=>l.initThread(t,this.memory))))}async destroy(){await Promise.all(this.workers.map(t=>t.terminate()))}getImportObj(t){const r=super.getImportObj(t);return{...r,wasi:{"thread-spawn":n=>{n=n>>>0;const s=this.nextThreadId++,a=this.nextWorker++%this.remoteWasms.length;return this.remoteWasms[a].call("wasi_thread_start",s,n).catch(this.logger),s}},env:{...r.env,env_hardware_concurrency:()=>this.remoteWasms.length+1}}}callWasmExport(t,r,n){const s=new Ye(this),a=s.getInputs(r),c=s.getOutputPtrs(n);this.call(t,...a,...c);const o=this.getOutputArgs(n,c,s);return s.freeAll(),o}getOutputArgs(t,r,n){return t.map((s,a)=>{if(s)return this.getMemorySlice(r[a],r[a]+s);const c=this.getMemorySlice(r[a],r[a]+4),o=new DataView(c.buffer,c.byteOffset,c.byteLength).getUint32(0,!0);n.addOutputPtr(o);const f=this.getMemorySlice(o,o+4),i=new DataView(f.buffer,f.byteOffset,f.byteLength).getUint32(0,!1);return this.getMemorySlice(o+4,o+4+i)})}}P.MAX_THREADS=32,addEventListener("message",e=>{e.data.log&&ie(e.data.log)}),V(new P),postMessage(Me)})();
